{{## def.coerceType:
  {{
    var $dataType = 'dataType' + $lvl
      , $coerced = 'coerced' + $lvl;
  }}
  var {{=$dataType}} = typeof {{=$dataList}};
  {{? it.opts.coerceTypes == 'array'}}
    if ({{=$dataType}} == 'object' && Array.isArray({{=$dataList}})) {{=$dataType}} = 'array';
  {{?}}

  var {{=$coerced}} = undefined;

  {{ var $bracesCoercion = ''; }}
  {{~ $coerceToTypes:$type:$i }}
    {{? $i }}
      if ({{=$coerced}} === undefined) {
      {{ $bracesCoercion += '}'; }}
    {{?}}

    {{? it.opts.coerceTypes == 'array' && $type != 'array' }}
      if ({{=$dataType}} == 'array' && {{=$dataList}}.length == 1) {
        {{=$coerced}} = {{=$dataList}} = {{=$dataList}}[0];
        {{=$dataType}} = typeof {{=$dataList}};
        /*if ({{=$dataType}} == 'object' && Array.isArray({{=$dataList}})) {{=$dataType}} = 'array';*/
      }
    {{?}}

    {{? $type == 'string' }}
      if ({{=$dataType}} == 'number' || {{=$dataType}} == 'boolean')
        {{=$coerced}} = '' + {{=$dataList}};
      else if ({{=$dataList}} === null) {{=$coerced}} = '';
    {{?? $type == 'number' || $type == 'integer' }}
      if ({{=$dataType}} == 'boolean' || {{=$dataList}} === null
          || ({{=$dataType}} == 'string' && {{=$dataList}} && {{=$dataList}} == +{{=$dataList}}
          {{? $type == 'integer' }} && !({{=$dataList}} % 1){{?}}))
        {{=$coerced}} = +{{=$dataList}};
    {{?? $type == 'boolean' }}
      if ({{=$dataList}} === 'false' || {{=$dataList}} === 0 || {{=$dataList}} === null)
        {{=$coerced}} = false;
      else if ({{=$dataList}} === 'true' || {{=$dataList}} === 1)
        {{=$coerced}} = true;
    {{?? $type == 'null' }}
      if ({{=$dataList}} === '' || {{=$dataList}} === 0 || {{=$dataList}} === false)
        {{=$coerced}} = null;
    {{?? it.opts.coerceTypes == 'array' && $type == 'array' }}
      if ({{=$dataType}} == 'string' || {{=$dataType}} == 'number' || {{=$dataType}} == 'boolean' || {{=$dataList}} == null)
        {{=$coerced}} = [{{=$dataList}}];
    {{?}}
  {{~}}

  {{= $bracesCoercion }}

  if ({{=$coerced}} === undefined) {
    {{# def.error:'type' }}
  } else {
    {{# def.setParentData }}
    {{=$dataList}} = {{=$coerced}};
    {{? !$dataLvl }}if ({{=$parentData}} !== undefined){{?}}
      {{=$parentData}}[{{=$parentDataProperty}}] = {{=$coerced}};
  }
#}}
